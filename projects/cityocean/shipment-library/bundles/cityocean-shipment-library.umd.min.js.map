{"version":3,"sources":["../../../../node_modules/tslib/tslib.es6.js","ng://@cityocean/shipment-library/lib/entities/shipmentStatus.ts","ng://@cityocean/shipment-library/lib/pipes/shipment-status.pipe.ts","ng://@cityocean/shipment-library/lib/service/shipment.service.ts","ng://@cityocean/shipment-library/lib/shipment-library.module.ts"],"names":["__assign","Object","assign","t","s","i","n","arguments","length","p","prototype","hasOwnProperty","call","apply","this","__awaiter","thisArg","_arguments","P","generator","Promise","resolve","reject","fulfilled","value","step","next","e","rejected","result","done","then","__generator","body","f","y","g","_","label","sent","trys","ops","verb","throw","return","Symbol","iterator","v","op","TypeError","pop","push","__read","o","m","r","ar","error","__spread","concat","ShipmentStatusEnum","SellerLocation","OriginStopOff","InTransitToDeparturePort","DeparturePort","InTransitToArrivalPort","ArrivalPort","InTransitToFinalDestination","DestinationStopOff","FinalDestination","Canceled","Completed","ShipmentStatusPipe","transform","args","_i","Pipe","name","ShipmentService","http","amapService","componentToHtmlService","GetAll","json","postJson","pipe","map","data","items","forEach","agreement","routeDetails","consigneeInfos","shipperInfos","transportType","freightMethodType","FreightMethodType","Ocean","shiperShow","shipperNetWorkInfo","consigneeShow","consigneeNetWorkInfo","console","log","state","status","containerList","containerListShow","sc","count","code","getStatistics","get","GetDetail","id","GetShipmentDetail","getMapShipRoute","pointList","mapIconList","point","coor","iconClass","ship","air","filter","includes","theme","isDanger","start","iconList","line","createShare","param","getShareHistory","shareSend","put","shareCancel","getShipTrack","needCount","url","longitudeDegree","latitudeDegree","getShipmentTrackByRes","res","route","vesselName","vessel","startTime","estDepatureOrginPortDate","endTime","estArrivalDestinationPortDate","getAllPortsForOthers","parm","getAllLocationsForOthers","getAllCompanyForOthers","createOrUpdateConditionGroup","getShipmentLinkDetail","Id","params","getShipmentMapDataByDetails","details","_this","forkJoin","detail","icons_1","lines_1","dashedLines_1","track_1","portAddress","originPort","destinationPort","port","fullName","googleGeo","toPromise","portPointList","_b","geometry","location","lng","lat","icon","unshift","all","streetAddress","address","_a","tslib_1.__read","shipperAddressList","consigneeAddressList","addressList","index","geo","icons","lines","dashedLines","e_1","getIconListByDetails","iconFactory","Math","random","template","getShipmentTemplate","portIconFactory","airFreightTypeIconFactory","track","reduce","acc","cur","val","truckIconFactory","repoList","geoList","fullname","portGeo","catchError","of","flatten","Injectable","providedIn","HttpService","AmapService","ComponentToHtmlService","pipes","ShipmentLibraryModule","NgModule","declarations","imports","exports","0","1","2","3","4","5","6"],"mappings":";;;;;;;;;;;;;;oFA6BO,IAAIA,EAAW,WAQlB,OAPAA,EAAWC,OAAOC,QAAU,SAAkBC,GAC1C,IAAK,IAAIC,EAAGC,EAAI,EAAGC,EAAIC,UAAUC,OAAQH,EAAIC,EAAGD,IAE5C,IAAK,IAAII,KADTL,EAAIG,UAAUF,GACOJ,OAAOS,UAAUC,eAAeC,KAAKR,EAAGK,KAAIN,EAAEM,GAAKL,EAAEK,IAE9E,OAAON,IAEKU,MAAMC,KAAMP,YA8BzB,SAASQ,EAAUC,EAASC,EAAYC,EAAGC,GAC9C,OAAO,IAAKD,IAAMA,EAAIE,WAAU,SAAUC,EAASC,GAC/C,SAASC,EAAUC,GAAS,IAAMC,EAAKN,EAAUO,KAAKF,IAAW,MAAOG,GAAKL,EAAOK,IACpF,SAASC,EAASJ,GAAS,IAAMC,EAAKN,EAAiB,MAAEK,IAAW,MAAOG,GAAKL,EAAOK,IACvF,SAASF,EAAKI,GAAUA,EAAOC,KAAOT,EAAQQ,EAAOL,OAAS,IAAIN,GAAE,SAAUG,GAAWA,EAAQQ,EAAOL,UAAWO,KAAKR,EAAWK,GACnIH,GAAMN,EAAYA,EAAUN,MAAMG,EAASC,GAAc,KAAKS,WAI/D,SAASM,EAAYhB,EAASiB,GACjC,IAAsGC,EAAGC,EAAGhC,EAAGiC,EAA3GC,EAAI,CAAEC,MAAO,EAAGC,KAAM,WAAa,GAAW,EAAPpC,EAAE,GAAQ,MAAMA,EAAE,GAAI,OAAOA,EAAE,IAAOqC,KAAM,GAAIC,IAAK,IAChG,OAAOL,EAAI,CAAEV,KAAMgB,EAAK,GAAIC,MAASD,EAAK,GAAIE,OAAUF,EAAK,IAAwB,mBAAXG,SAA0BT,EAAES,OAAOC,UAAY,WAAa,OAAOhC,OAAUsB,EACvJ,SAASM,EAAKpC,GAAK,OAAO,SAAUyC,GAAK,OACzC,SAAcC,GACV,GAAId,EAAG,MAAM,IAAIe,UAAU,mCAC3B,KAAOZ,GAAG,IACN,GAAIH,EAAI,EAAGC,IAAMhC,EAAY,EAAR6C,EAAG,GAASb,EAAU,OAAIa,EAAG,GAAKb,EAAS,SAAOhC,EAAIgC,EAAU,SAAMhC,EAAES,KAAKuB,GAAI,GAAKA,EAAET,SAAWvB,EAAIA,EAAES,KAAKuB,EAAGa,EAAG,KAAKlB,KAAM,OAAO3B,EAE3J,OADIgC,EAAI,EAAGhC,IAAG6C,EAAK,CAAS,EAARA,EAAG,GAAQ7C,EAAEqB,QACzBwB,EAAG,IACP,KAAK,EAAG,KAAK,EAAG7C,EAAI6C,EAAI,MACxB,KAAK,EAAc,OAAXX,EAAEC,QAAgB,CAAEd,MAAOwB,EAAG,GAAIlB,MAAM,GAChD,KAAK,EAAGO,EAAEC,QAASH,EAAIa,EAAG,GAAIA,EAAK,CAAC,GAAI,SACxC,KAAK,EAAGA,EAAKX,EAAEI,IAAIS,MAAOb,EAAEG,KAAKU,MAAO,SACxC,QACI,KAAkB/C,GAAZA,EAAIkC,EAAEG,MAAYhC,OAAS,GAAKL,EAAEA,EAAEK,OAAS,MAAkB,IAAVwC,EAAG,IAAsB,IAAVA,EAAG,IAAW,CAAEX,EAAI,EAAG,SACjG,GAAc,IAAVW,EAAG,MAAc7C,GAAM6C,EAAG,GAAK7C,EAAE,IAAM6C,EAAG,GAAK7C,EAAE,IAAM,CAAEkC,EAAEC,MAAQU,EAAG,GAAI,MAC9E,GAAc,IAAVA,EAAG,IAAYX,EAAEC,MAAQnC,EAAE,GAAI,CAAEkC,EAAEC,MAAQnC,EAAE,GAAIA,EAAI6C,EAAI,MAC7D,GAAI7C,GAAKkC,EAAEC,MAAQnC,EAAE,GAAI,CAAEkC,EAAEC,MAAQnC,EAAE,GAAIkC,EAAEI,IAAIU,KAAKH,GAAK,MACvD7C,EAAE,IAAIkC,EAAEI,IAAIS,MAChBb,EAAEG,KAAKU,MAAO,SAEtBF,EAAKf,EAAKrB,KAAKI,EAASqB,GAC1B,MAAOV,GAAKqB,EAAK,CAAC,EAAGrB,GAAIQ,EAAI,EAAI,QAAWD,EAAI/B,EAAI,EACtD,GAAY,EAAR6C,EAAG,GAAQ,MAAMA,EAAG,GAAI,MAAO,CAAExB,MAAOwB,EAAG,GAAKA,EAAG,QAAK,EAAQlB,MAAM,GArB9BL,CAAK,CAACnB,EAAGyC,MAwCtD,SAASK,EAAOC,EAAG/C,GACtB,IAAIgD,EAAsB,mBAAXT,QAAyBQ,EAAER,OAAOC,UACjD,IAAKQ,EAAG,OAAOD,EACf,IAAmBE,EAAY5B,EAA3BtB,EAAIiD,EAAE1C,KAAKyC,GAAOG,EAAK,GAC3B,IACI,WAAc,IAANlD,GAAgBA,KAAM,MAAQiD,EAAIlD,EAAEqB,QAAQI,MAAM0B,EAAGL,KAAKI,EAAE/B,OAExE,MAAOiC,GAAS9B,EAAI,CAAE8B,MAAOA,GACjC,QACQ,IACQF,IAAMA,EAAEzB,OAASwB,EAAIjD,EAAU,SAAIiD,EAAE1C,KAAKP,GAE1D,QAAkB,GAAIsB,EAAG,MAAMA,EAAE8B,OAE7B,OAAOD,EAGJ,SAASE,IACZ,IAAK,IAAIF,EAAK,GAAInD,EAAI,EAAGA,EAAIE,UAAUC,OAAQH,IAC3CmD,EAAKA,EAAGG,OAAOP,EAAO7C,UAAUF,KACpC,OAAOmD,EC3IX,IAUYI,EAAkB,CAC5BC,eAAc,EACdC,cAAa,EACbC,yBAAwB,EACxBC,cAAa,EACbC,uBAAsB,EACtBC,YAAW,EACXC,4BAA2B,EAC3BC,mBAAkB,EAClBC,iBAAgB,EAChBC,SAAQ,EACRC,UAAS,qcCrBX,IAAAC,EAAA,WAGA,SAAAA,KA0BA,OArBEA,EAAA9D,UAAA+D,UAAA,SAAUjD,OAA2B,IAAAkD,EAAA,GAAAC,EAAA,EAAAA,EAAApE,UAAAC,OAAAmE,IAAAD,EAAAC,EAAA,GAAApE,UAAAoE,GACnC,OAAQnD,GACN,KAAKoC,EAAmBC,eACtB,MAAO,8BACT,KAAKD,EAAmBG,yBACtB,MAAO,+BACT,KAAKH,EAAmBI,cACtB,MAAO,iBACT,KAAKJ,EAAmBK,uBACtB,MAAO,6BACT,KAAKL,EAAmBM,YACtB,MAAO,gBACT,KAAKN,EAAmBO,4BACtB,MAAO,kCACT,KAAKP,EAAmBS,iBACtB,MAAO,oBACT,QACE,MAAO,yBAtBdO,EAAAA,KAAIF,KAAA,CAAC,CACJG,KAAM,qBAyBRL,EA7BA,gBCgBE,SAAAM,EACSC,EACCC,EACAC,GAFDnE,KAAAiE,KAAAA,EACCjE,KAAAkE,YAAAA,EACAlE,KAAAmE,uBAAAA,SAIVH,EAAApE,UAAAwE,OAAA,SAAOC,GACL,OAAOrE,KAAKiE,KAAKK,SAAS,2BAA4BD,GACnDE,KAAKC,EAAAA,KAAG,SAAEC,GAmBT,OAlBaA,EAAKC,MACbC,SAAO,SAACrF,GACXA,EAAEsF,UAAqD,IAAzCtF,EAAEuF,aAAaC,eAAepF,QAAuD,IAAvCJ,EAAEuF,aAAaE,aAAarF,OAAe,QAAiD,IAAvCJ,EAAEuF,aAAaE,aAAarF,OAAe,UAAqD,IAAzCJ,EAAEuF,aAAaC,eAAepF,OAAe,UAAY,YACjOJ,EAAE0F,cAAgB1F,EAAE2F,oBAAsBC,EAAAA,kBAAkBC,MAAQ,OAAS,MAC7E,IACE7F,EAAE8F,WAAa9F,EAAEuF,aAAaE,aAAarF,QAAUJ,EAAEuF,aAAaE,aAAa,GAAGM,mBAAmBtB,MAAQ,GAC/GzE,EAAEgG,cAAgBhG,EAAEuF,aAAaC,eAAepF,QAAUJ,EAAEuF,aAAaC,eAAe,GAAGS,qBAAqBxB,MAAQ,GACxH,MAAOlD,GACP2E,QAAQC,IAAI5E,GAEdvB,EAAEoG,MAAQpG,EAAEqG,OACRrG,EAAEsG,gBACJtG,EAAEuG,kBAAoB,GACtBvG,EAAEsG,cAAcjB,SAAO,SAACmB,GACtBxG,EAAEuG,mBAAwBC,EAAGC,MAAK,IAAID,EAAGE,KAAS,WAIjDvB,OAIbT,EAAApE,UAAAqG,cAAA,WAEE,OAAOjG,KAAKiE,KAAKiC,IADL,yCAIdlC,EAAApE,UAAAuG,UAAA,SAAUC,GACR,OAAOpG,KAAKiE,KAAKiC,IAAI,0BAA2B,CAACE,GAAEA,KAGrDpC,EAAApE,UAAAyG,kBAAA,SAAkBD,GAChB,OAAOpG,KAAKiE,KAAKiC,IAAI,kCAAmC,CAACE,GAAEA,KAG7DpC,EAAApE,UAAA0G,gBAAA,SAAgBC,QAAA,IAAAA,IAAAA,EAAA,QACVC,EAAc,GAEZC,EACK,CAACC,KAAM,EAAE,WAAY,WAAYC,UAAW,4BADjDF,EAEO,CAACC,KAAM,EAAE,WAAY,WAAYC,UAAW,4BAFnDF,EAGK,CAACC,KAAM,EAAE,WAAY,WAAYC,UAAW,4BAKjD3B,EAAgB,CACpB4B,KAAM,2BACNC,IAAK,0BAED9F,EAASwF,EAAUO,QAAM,SAACvE,GAC9B,OAAOA,EAAEwB,KAAKgD,SAAS,cAAgBxE,EAAEwB,KAAKgD,SAAS,YAAcxE,EAAEwB,KAAKgD,SAAS,cA8CvF,OAzCIhG,EAAOrB,QAAU,IACnB8G,EAAczF,EAAOyD,KAAG,SAACjC,GACvB,OAAIA,EAAEwB,KAAKgD,SAAS,aAClB7H,EAAA,GACKuH,EAAe,CAClBL,GAAI7D,EAAE6D,GACNY,MAAOzE,EAAE0E,SAAW,QAAU,GAC9BN,UAAW3B,EAAczC,EAAEyC,iBAG3BzC,EAAEwB,KAAKgD,SAAS,WAClB7H,EAAA,GACKuH,EAAa,CAChBL,GAAI7D,EAAE6D,GACNc,OAAO,EACPF,MAAOzE,EAAE0E,SAAW,QAAU,GAC9BN,UAAW3B,EAAczC,EAAEyC,iBAG3BzC,EAAEwB,KAAKgD,SAAS,WAClB7H,EAAA,GACKuH,EAAa,CAChBL,GAAI7D,EAAE6D,GACNY,MAAOzE,EAAE0E,SAAW,QAAU,GAC9BN,UAAW3B,EAAczC,EAAEyC,sBAL/B,KAkBEjE,EAAO,IAAMA,EAAO,GAAGmG,OAItB,CAACC,SAAUX,EAAaY,KA5DpB,KA+DbpD,EAAApE,UAAAyH,YAAA,SAAYC,GACV,YADU,IAAAA,IAAAA,EAAA,IACHtH,KAAKiE,KAAKK,SAAS,gCAAiCgD,IAG7DtD,EAAApE,UAAA2H,gBAAA,SAAgBD,QAAA,IAAAA,IAAAA,EAAA,IAEd,OAAOtH,KAAKiE,KAAKiC,IADL,gCACcoB,IAG5BtD,EAAApE,UAAA4H,UAAA,SAAUF,GAER,OAAOtH,KAAKiE,KAAKwD,IADL,gCACcH,IAG5BtD,EAAApE,UAAA8H,YAAA,SAAYtB,GAEV,OAAOpG,KAAKiE,KAAKK,SADL,gCACmB,CAAC8B,GAAEA,KAGpCpC,EAAApE,UAAA+H,aAAA,SAAaL,GAGX,OADKA,EAAMM,YAAWN,EAAMM,UAAY,KACjC5H,KAAKiE,KAAKiC,IAAO2B,mJAErBtD,KACCC,EAAAA,KAAG,SAAEjC,GACH,OAAOA,EAAEiC,KAAG,SAACiC,GACX,OAAAvH,EAAA,GACKuH,EAAK,CACRA,MAAO,CAACA,EAAMqB,gBAAiBrB,EAAMsB,0BAOjD/D,EAAApE,UAAAoI,sBAAA,SAAsBC,OACdC,EAAQD,EAAIpD,aAClB,OAAO7E,KAAK2H,aAAa,CACvBQ,WAAYF,EAAIG,OAChBC,UAAWH,EAAMI,yBACjBC,QAASL,EAAMM,iCAInBxE,EAAApE,UAAA6I,qBAAA,SAAqBC,GACnB,OAAO1I,KAAKiE,KAAKiC,IAAI,qCAAsCwC,IAG7D1E,EAAApE,UAAA+I,yBAAA,SAAyBD,GACvB,OAAO1I,KAAKiE,KAAKiC,IAAI,yCAA0CwC,IAGjE1E,EAAApE,UAAAgJ,uBAAA,WACE,OAAO5I,KAAKiE,KAAKiC,IAAI,yCAGvBlC,EAAApE,UAAAiJ,6BAAA,SAA6BvB,GAC3B,OAAOtH,KAAKiE,KAAKK,SAAS,wDAAyDgD,IAGrFtD,EAAApE,UAAAkJ,sBAAA,SAAsBC,OAChBC,EAAS,CAACD,GAAEA,GAChB,OAAO/I,KAAKiE,KAAKiC,IAAI,mCAAoC8C,IAQ3DhF,EAAApE,UAAAqJ,4BAAA,SAA4BC,GAA5B,IAAAC,EAAAnJ,KACE,OAAOoJ,EAAAA,SACLF,EAAQ1E,KAAG,SAAC6E,GACV,OAAO,IAAI/I,SAAO,SAAyDC,GAAO,OAAAN,EAAAkJ,OAAA,OAAA,GAAA,8FAQvD,6BANjBG,EAAQ,GACRC,EAAQ,GACRC,EAAc,GAChBC,EAAe,GACbC,EACJ,CAACL,EAAOxE,aAAa8E,WAAYN,EAAOxE,aAAa+E,iBAAiBpF,KAAG,SAACqF,GAAQ,OAAGA,EAAK9F,KAAI,IAAI8F,EAAKC,YAClF,CAAA,EAAMV,EAAAA,SAASM,EAAYlF,KAAG,SAACjC,GAAK,OAAA4G,EAAKjF,YAAY6F,UAAUxH,OAAKyH,2BAArFC,EAAiBC,EAAAzI,OACpB+C,KAAG,SAACjC,GAAK,MAAA,CAACA,EAAE4H,SAASC,SAASC,IAAK9H,EAAE4H,SAASC,SAASE,QAEtDjB,EAAOpE,oBAAsBC,EAAAA,kBAAkBC,MAA/C,CAAA,EAAA,IAEFmE,EAAMjH,KAAK,CACToE,MAAOwD,EAAc,GACrBM,KAAM,aACL,CAAE9D,MAAOwD,EAAc,GAAIM,KAAM,cAC5B,CAAA,EAAOvK,KAAKgI,sBAAsBqB,GACvC9E,KAAKC,EAAAA,KAAG,SAACjC,GAAK,OAAAA,EAAEiC,KAAG,SAAC7E,GAAK,OAAAA,EAAE8G,aAC3BuD,4BAFHP,EAAQS,EAAAzI,QAIE/B,QAAU2J,EAAO1D,SAAW7C,EAAmBK,wBACvDmG,EAAMjH,KAAK,CACToE,MAAOgD,EAAMA,EAAM/J,OAAS,GAC5B6K,KAAM,iCAKVjB,EAAMjH,KAAK,CACToE,MAAOwD,EAAc,GACrBM,KAAM,aACL,CAAE9D,MAAOwD,EAAc,GAAIM,KAAM,cAEhClB,EAAO1D,SAAW7C,EAAmBK,wBACvCmG,EAAMjH,KAAK,CACToE,MACE,CAACgD,EAAM,GAAG,GAAKA,EAAM,GAAG,GAAIA,EAAM,GAAG,GAAKA,EAAM,GAAG,IAG/CjF,KAAG,SAACjC,GAAK,OAAAA,EAAI,KACnBgI,KAAM,mCAaI,OARhBd,EAAMe,QAAQP,EAAc,IAC5BR,EAAMpH,KAAK4H,EAAc,IAErB,CAACnH,EAAmBK,uBAAwBL,EAAmBM,aAAa2D,SAASsC,EAAO1D,SAC9F4D,EAAMlH,KAAKoH,GAEbD,EAAYnH,KAAKoH,GAED,CAAA,EAAMnJ,QAAQmK,IAAI,CAChCrB,EAAAA,SACEC,EAAOxE,aAAaE,aAAaP,KAAG,SAACjC,GAAK,OAAA4G,EAAKjF,YAAY6F,UAAUxH,EAAE8C,mBAAmBqF,mBAC1FV,YACFZ,EAAAA,SACEC,EAAOxE,aAAaC,eAAeN,KAAG,SAACjC,GAAK,OAAA4G,EAAKjF,YAAY6F,UAAUxH,EAAEgD,qBAAqBmF,mBAC9FV,6BANEW,EAAUT,EAAAzI,OASVmJ,EAAAC,EAA6CF,EAAQnG,KAAG,SAACjC,GAAK,OAAAA,GAAQ,MAAG,GAAxEuI,EAAkBF,EAAA,GAAEG,EAAoBH,EAAA,GAC/C,CAACE,EAAoBC,GAAsBpG,SAAO,SAAEqG,EAAaC,GAC/DD,EAAYxG,KAAG,SAAC0G,OACRzE,EAAQ,CAACyE,EAAIf,SAASC,SAASC,IAAKa,EAAIf,SAASC,SAASE,KAKhE,OAJAhB,EAAMjH,KAAK,CACToE,MAAKA,EACL8D,KAAM,mBAEAU,GACN,KAAK,EACHzB,EAAYnH,KAAK,CAACoE,EAAOgD,EAAM,KAC3BJ,EAAO1D,OAAS7C,EAAmBG,yBACrCsG,EAAMlH,KAAK,CAACoE,EAAOgD,EAAM,KAChBJ,EAAO1D,SAAW7C,EAAmBG,0BAC9CqG,EAAMjH,KAAK,CACToE,MAAO,CAACA,EAAM,GAAKgD,EAAM,GAAG,GAAIhD,EAAM,GAAKgD,EAAM,GAAG,IAAIjF,KAAG,SAACjC,GAAK,OAAAA,EAAI,KACrEgI,KAAM,eAGV,MACF,KAAK,EACHf,EAAYnH,KAAK,CAACoH,EAAMA,EAAM/J,OAAS,GAAI+G,IACvC4C,EAAO1D,OAAS7C,EAAmBO,4BACrCkG,EAAMlH,KAAK,CAACoH,EAAMA,EAAM/J,OAAS,GAAI+G,IAC5B4C,EAAO1D,SAAW7C,EAAmBO,6BAC9CiG,EAAMjH,KAAK,CACToE,MAAO,CAACA,EAAM,GAAKgD,EAAMA,EAAM/J,OAAS,GAAG,GAAI+G,EAAM,GAAKgD,EAAMA,EAAM/J,OAAS,GAAG,IAAI8E,KAAG,SAACjC,GAAK,OAAAA,EAAI,KACnGgI,KAAM,sBASlBhK,EAAQ,CAAC4K,MAAK7B,EAAE8B,MAAK7B,EAAE8B,YAAW7B,mCAElChE,QAAQ7C,MAAM2I,GACd/K,EAAQ,2CAIdgE,KACAC,EAAAA,KAAG,SAACjC,GAAK,OAAAA,EAAEuE,QAAM,SAACnH,GAAK,OAAAA,UAQ3BqE,EAAApE,UAAA2L,qBAAA,SAAqBrC,GAArB,IAAAC,EAAAnJ,KACQwL,EAAW,SAAI7L,EAAG4K,EAAMlB,GAAW,MAAA,CACvC5C,MAAO,CACL9G,EAAEwK,SAASC,SAASC,IAAsB,KAAhBoB,KAAKC,SAAmB,KAClD/L,EAAEwK,SAASC,SAASE,IAAsB,KAAhBmB,KAAKC,SAAmB,MAEpDC,SAAUxC,EAAKhF,uBAAuByH,oBAAoBvC,GAC1DkB,KAAIA,EACJ9F,KAAM4E,IAGFwC,EAAe,SAAIhC,EAAMR,GAC7B,OAAAF,EAAKjF,YAAY6F,UAAaF,EAAK9F,KAAI,IAAI8F,EAAKC,UAC7CvF,KACCC,EAAAA,KAAG,SAACjC,GAAK,OAAAiJ,EAAYjJ,EAAI8G,EAAOpE,oBAAsBC,EAAAA,kBAAkBC,MAAQ,kBAAoB,gBAAiBkE,OACrHW,aAEA8B,EAAyB,SAAUzC,GAAM,OAAApJ,EAAAkJ,OAAA,OAAA,GAAA,4EAG9B,OAFTO,EACJ,CAACL,EAAOxE,aAAa8E,WAAYN,EAAOxE,aAAa+E,iBAAiBpF,KAAG,SAACqF,GAAQ,OAAGA,EAAK9F,KAAI,IAAI8F,EAAKC,YAC1F,CAAA,EAAMV,EAAAA,SAASM,EAAYlF,KAAG,SAACjC,GAAK,OAAA4G,EAAKjF,YAAY6F,UAAUxH,OAAKyH,oBAWnF,OAXM+B,EAASnB,EAAAnJ,OACZ+C,KAAG,SAACjC,GAAK,MAAA,CAACA,EAAE4H,SAASC,SAASC,IAAK9H,EAAE4H,SAASC,SAASE,QAU1D,CAAA,EATc,CACZ7D,MACEsF,EAAMC,QAAM,SACTC,EAAuBC,GAA0B,OAAAD,EAAIzH,KAAG,SAAE2H,EAAK5M,GAAM,OAAA4M,EAAMD,EAAI3M,SAChFiF,KAAG,SAACjC,GAAK,OAAAA,EAAI,KACjBgI,KAAM,gBACNoB,SAAU3L,KAAKmE,uBAAuByH,oBAAoBvC,GAC1D5E,KAAM4E,YAKJ+C,EAAgB,SAAUC,EAAiBxC,EAAMR,GAAM,OAAApJ,EAAAkJ,OAAA,OAAA,GAAA,4EAC3C,MAAA,CAAA,EAAMC,EAAAA,SACpBiD,EAAS7H,KAAG,SAACjC,GAAK,OAAA4G,EAAKjF,YAAY6F,UAAUxH,EAAE8C,mBAAmBqF,mBAClEV,oBACc,OAHVsC,EAAU1B,EAAAnJ,OAGA,CAAA,EAAMzB,KAAKkE,YAAY6F,UAAaF,EAAK9F,KAAI,IAAI8F,EAAK0C,UAAYvC,oBAClF,OADMwC,EAAU5B,EAAAnJ,OAChB,CAAA,EAAO6K,EAAQ9H,KAAG,SAAC0G,GAGjB,OAFAA,EAAIf,SAASC,SAASC,KAAOa,EAAIf,SAASC,SAASC,IAAMmC,EAAQrC,SAASC,SAASC,KAAO,EAC1Fa,EAAIf,SAASC,SAASE,KAAOY,EAAIf,SAASC,SAASE,IAAMkC,EAAQrC,SAASC,SAASE,KAAO,EACnFkB,EAAYN,EAAK,aAAc7B,eAI1C,OAAOD,EAAAA,SAELF,EAAQ1E,KAAG,SAAO6E,GAAM,OAAApJ,EAAAkJ,OAAA,OAAA,GAAA,iDACtB,IAKE,OAJmBE,EAAOxE,aAAa8E,WACfN,EAAOxE,aAAa+E,gBAGpCP,EAAO1D,QACb,KAAK7C,EAAmBC,eACxB,KAAKD,EAAmBE,cACxB,KAAKF,EAAmBG,yBACtB,MAAA,CAAA,EAAOmG,EAAAA,SACLC,EAAOxE,aAAaE,aAAaP,KAAG,SAACjC,GAAK,OAAA4G,EAAKjF,YAAY6F,UAAUxH,EAAE8C,mBAAmBqF,mBAC1FnG,KACAC,EAAAA,KAAG,SAACjC,GACF,OAAAA,EAAEiC,KAAG,SACH7E,GAAK,OAAA6L,EAAY7L,EAAG,uBAAwB0J,UAGhDW,aACJ,KAAKlH,EAAmBI,cACtB,MAAA,CAAA,EAAO2I,EAAgBxC,EAAOxE,aAAa8E,WAAYN,IACzD,KAAKvG,EAAmBK,uBAGtB,MAAA,CAAA,EAAOkG,EAAOpE,oBAAsBC,EAAAA,kBAAkBC,MACpDnF,KAAKgI,sBAAsBqB,GACxB9E,KACCC,EAAAA,KAAG,SAACjC,GAAK,OAAAA,EAAE7C,OAAS8L,EAAY,CAAErB,SAAU,CAACC,SAAU,CAAEC,IAAK9H,EAAE7C,OAAO,GAAG+G,MAAM,GAAI6D,IAAK/H,EAAE7C,OAAO,GAAG+G,MAAM,MAAQ,kBAAmB4C,GAAUwC,EAAgBxC,EAAOxE,aAAa8E,WAAYN,OAChMW,YACF8B,EAA0BzC,IAChC,KAAKvG,EAAmBM,YACtB,MAAA,CAAA,EAAOyI,EAAgBxC,EAAOxE,aAAa+E,gBAAiBP,IAC9D,KAAKvG,EAAmBO,4BACtB,MAAA,CAAA,EAAO+I,EAAiB/C,EAAOxE,aAAaC,eAAgBuE,EAAOxE,aAAa+E,gBAAiBP,IACnG,KAAKvG,EAAmBS,iBACtB,MAAA,CAAA,EAAO6F,EAAAA,SACLC,EAAOxE,aAAaC,eAAeN,KAAG,SAACjC,GAAK,OAAA4G,EAAKjF,YAAY6F,UAAUxH,EAAEgD,qBAAqBmF,mBAC9FnG,KACAC,EAAAA,KAAG,SAACjC,GACF,OAAAA,EAAEiC,KAAG,SACH7E,GAAK,OAAA6L,EAAY7L,EAAG,uBAAwB0J,UAGhDW,cAGN,MAAOnJ,GAEP,OADA2E,QAAQ7C,MAAM9B,GACd,CAAA,EAAO,wBAIX0D,KACAkI,EAAAA,YAAU,SAAE5L,GAEV,OADA2E,QAAQ7C,MAAM9B,GACP6L,EAAAA,GAAG,OAEZlI,EAAAA,KAAG,SAACjC,GAAK,OAAAoK,EAAAA,QAAQpK,4BAxZtBqK,EAAAA,WAAUhJ,KAAA,CAAC,CACViJ,WAAY,oDAZLC,EAAAA,mBAQwBC,EAAAA,mBAAxBC,EAAAA,kOCNHC,EAAQ,CACZvJ,GAGFwJ,EAAA,WAAA,SAAAA,KAUqC,2BAVpCC,EAAAA,SAAQvJ,KAAA,CAAC,CACRwJ,aAAYxK,EACPqK,GAELI,QAAS,GAETC,QAAO1K,EACFqK,OAG8BC,EAVrC,yFHP8B,CAC5BK,EAAG,8BACLC,EAAG,+BACHC,EAAG,iBACHC,EAAG,6BACHC,EAAG,gBACHC,EAAG,kCACHC,EAAG","sourcesContent":["/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation. All rights reserved.\r\nLicensed under the Apache License, Version 2.0 (the \"License\"); you may not use\r\nthis file except in compliance with the License. You may obtain a copy of the\r\nLicense at http://www.apache.org/licenses/LICENSE-2.0\r\n\r\nTHIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\nKIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED\r\nWARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,\r\nMERCHANTABLITY OR NON-INFRINGEMENT.\r\n\r\nSee the Apache Version 2.0 License for specific language governing permissions\r\nand limitations under the License.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nexport function __extends(d, b) {\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nexport var __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    }\r\n    return __assign.apply(this, arguments);\r\n}\r\n\r\nexport function __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\r\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\r\n                t[p[i]] = s[p[i]];\r\n        }\r\n    return t;\r\n}\r\n\r\nexport function __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\r\n\r\nexport function __param(paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n}\r\n\r\nexport function __metadata(metadataKey, metadataValue) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\r\n}\r\n\r\nexport function __awaiter(thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nexport function __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nexport function __exportStar(m, exports) {\r\n    for (var p in m) if (!exports.hasOwnProperty(p)) exports[p] = m[p];\r\n}\r\n\r\nexport function __values(o) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator], i = 0;\r\n    if (m) return m.call(o);\r\n    return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n}\r\n\r\nexport function __read(o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n}\r\n\r\nexport function __spread() {\r\n    for (var ar = [], i = 0; i < arguments.length; i++)\r\n        ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n}\r\n\r\nexport function __spreadArrays() {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n};\r\n\r\nexport function __await(v) {\r\n    return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n}\r\n\r\nexport function __asyncGenerator(thisArg, _arguments, generator) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n    return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n    function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\r\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\r\n    function fulfill(value) { resume(\"next\", value); }\r\n    function reject(value) { resume(\"throw\", value); }\r\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n}\r\n\r\nexport function __asyncDelegator(o) {\r\n    var i, p;\r\n    return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\r\n    function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: n === \"return\" } : f ? f(v) : v; } : f; }\r\n}\r\n\r\nexport function __asyncValues(o) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var m = o[Symbol.asyncIterator], i;\r\n    return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\r\n    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\r\n    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\r\n}\r\n\r\nexport function __makeTemplateObject(cooked, raw) {\r\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n    return cooked;\r\n};\r\n\r\nexport function __importStar(mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];\r\n    result.default = mod;\r\n    return result;\r\n}\r\n\r\nexport function __importDefault(mod) {\r\n    return (mod && mod.__esModule) ? mod : { default: mod };\r\n}\r\n","export const shipmentStatus = {\r\n  0: 'Seller \\'s Location / Booked',\r\n1: 'In Transit to Departure Port',\r\n2: 'Departure Port',\r\n3: 'In Transit to Arrival Port',\r\n4: 'Arrival  port',\r\n5: 'In Transit to Final Destination',\r\n6: 'Final destination',\r\n}\r\n\r\nexport enum ShipmentStatusEnum {\r\n  SellerLocation,\r\n  OriginStopOff,\r\n  InTransitToDeparturePort,\r\n  DeparturePort,\r\n  InTransitToArrivalPort,\r\n  ArrivalPort,\r\n  InTransitToFinalDestination,\r\n  DestinationStopOff,\r\n  FinalDestination,\r\n  Canceled,\r\n  Completed,\r\n}\r\n","import { Pipe, PipeTransform } from '@angular/core';\nimport { ShipmentStatusEnum } from '../entities/shipmentStatus';\n\n@Pipe({\n  name: 'shipmentStatus'\n})\nexport class ShipmentStatusPipe implements PipeTransform {\n\n  transform(value: ShipmentStatusEnum, ...args: any[]): any {\n    switch (value) {\n      case ShipmentStatusEnum.SellerLocation:\n        return `Seller 's Location / Booked`;\n      case ShipmentStatusEnum.InTransitToDeparturePort:\n        return `In Transit to Departure Port`;\n      case ShipmentStatusEnum.DeparturePort:\n        return `Departure Port`;\n      case ShipmentStatusEnum.InTransitToArrivalPort:\n        return `In Transit to Arrival Port`;\n      case ShipmentStatusEnum.ArrivalPort:\n        return `Arrival  port`;\n      case ShipmentStatusEnum.InTransitToFinalDestination:\n        return `In Transit to Final Destination`;\n      case ShipmentStatusEnum.FinalDestination:\n        return `Final destination`;\n      default:\n        return '';\n    }\n  }\n\n}\n","import { Injectable } from '@angular/core';\r\nimport { HttpService } from '@cityocean/common-library';\r\nimport { TransportationMode } from '../class/TransportationMode';\r\nimport { catchError, map } from 'rxjs/operators';\r\nimport { forkJoin, Observable, of } from 'rxjs';\r\nimport { flatten } from 'lodash';\r\nimport { ShipmentDetail } from '../entities/ShipmentDetail';\r\nimport { FreightMethodType } from '@cityocean/basicdata-library';\r\nimport { VesselTrackPoint } from '../entities/VesselTrackPoint';\r\nimport { ComponentToHtmlService, AmapService } from '@cityocean/amap-library';\r\nimport { ShipmentStatusEnum } from '../entities/shipmentStatus';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class ShipmentService {\r\n  constructor(\r\n    public http: HttpService,\r\n    private amapService: AmapService,\r\n    private componentToHtmlService: ComponentToHtmlService,\r\n  ) {\r\n  }\r\n\r\n  GetAll(json: { SearchKey?: string, IsDelivered?: boolean, TransportationMode?: TransportationMode, Sorting?: string, MaxResultCount?: number, SkipCount?: number }) {\r\n    return this.http.postJson('/CSP/Shipment/GetAllList', json)\r\n      .pipe(map((data: any) => {\r\n        const temp = data.items;\r\n        temp.forEach(s => {\r\n          s.agreement = s.routeDetails.consigneeInfos.length === 0 && s.routeDetails.shipperInfos.length === 0 ? 'cy-cy' : s.routeDetails.shipperInfos.length === 0 ? 'cy-door' : s.routeDetails.consigneeInfos.length === 0 ? 'door-cy' : 'door-door';\r\n          s.transportType = s.freightMethodType === FreightMethodType.Ocean ? 'ship' : 'air';\r\n          try {\r\n            s.shiperShow = s.routeDetails.shipperInfos.length && s.routeDetails.shipperInfos[0].shipperNetWorkInfo.name || '';\r\n            s.consigneeShow = s.routeDetails.consigneeInfos.length && s.routeDetails.consigneeInfos[0].consigneeNetWorkInfo.name || '';\r\n          } catch (e) {\r\n            console.log(e);\r\n          }\r\n          s.state = s.status;\r\n          if (s.containerList) {\r\n            s.containerListShow = '';\r\n            s.containerList.forEach(sc => {\r\n              s.containerListShow += `${sc.count}*${sc.code}` + ' ';\r\n            });\r\n          }\r\n        });\r\n        return data;\r\n      }));\r\n  }\r\n\r\n  getStatistics() {\r\n    const url = `/CSP/Shipment/GetShipmentsStatistics`;\r\n    return this.http.get(url);\r\n  }\r\n\r\n  GetDetail(id: number): Observable<ShipmentDetail> {\r\n    return this.http.get('/CSP/Shipment/GetDetail', {id}) as any;\r\n  }\r\n\r\n  GetShipmentDetail(id: number) {\r\n    return this.http.get('/CSP/Shipment/GetShipmentDetail', {id});\r\n  }\r\n\r\n  getMapShipRoute(pointList = []) {\r\n    let mapIconList = [];\r\n    let line = [];\r\n    const point = {\r\n      yantian: {coor: [-247.388497, 22.551956], iconClass: 'icon-icon_oceanshipmentx'},\r\n      guangzhou: {coor: [-246.629063, 22.594968], iconClass: 'icon-icon_oceanshipmentx'},\r\n      angeles: {coor: [-118.243707, 34.053945], iconClass: 'icon-icon_oceanshipmentx'},\r\n    };\r\n    /*const result = e.some(o => o.name.includes('benefit')) &&\r\n      e.some(o => o.name.includes('angeles')) &&\r\n      e.some(o => o.name.includes('yantian'));*/\r\n    const transportType = {\r\n      ship: 'icon-icon_oceanshipmentx',\r\n      air: 'icon-icon_airshipmentx',\r\n    };\r\n    const result = pointList.filter(o => {\r\n      return o.name.includes('guangzhou') || o.name.includes('angeles') || o.name.includes('yantian');\r\n    });\r\n    const random = (arr: number[]) => {\r\n      return arr.map(o => o += Math.random());\r\n    };\r\n    if (result.length >= 1) {\r\n      mapIconList = result.map(o => {\r\n        if (o.name.includes('guangzhou')) {\r\n          return {\r\n            ...point.guangzhou,\r\n            id: o.id,\r\n            theme: o.isDanger ? 'error' : '',\r\n            iconClass: transportType[o.transportType],\r\n          };\r\n        }\r\n        if (o.name.includes('angeles')) {\r\n          return {\r\n            ...point.angeles,\r\n            id: o.id,\r\n            start: false,\r\n            theme: o.isDanger ? 'error' : '',\r\n            iconClass: transportType[o.transportType],\r\n          };\r\n        }\r\n        if (o.name.includes('yantian')) {\r\n          return {\r\n            ...point.yantian,\r\n            id: o.id,\r\n            theme: o.isDanger ? 'error' : '',\r\n            iconClass: transportType[o.transportType],\r\n          };\r\n        }\r\n      });\r\n      /*mapIconList.forEach(o => {\r\n        o.coor = random(o.coor);\r\n      });*/\r\n      /*this.fakeMapData = [\r\n        { coor: [-246.788497, 23.121956], iconClass: 'icon-icon_oceanshipmentx' },\r\n        { coor: [-247.388497, 22.551956], iconClass: 'icon-icon_oceanshipmentx' },\r\n        { coor: [-246.629063, 22.594968], iconClass: 'icon-icon_oceanshipmentx' },\r\n        { coor: [-118.243707, 34.053945], iconClass: 'icon-icon_oceanshipmentx' },\r\n      ]; */\r\n      if (result[0] && result[0].start !== false) {\r\n      }\r\n    }\r\n\r\n    return {iconList: mapIconList, line};\r\n  }\r\n\r\n  createShare(param = {}) {\r\n    return this.http.postJson('/CSP/ShipmentShareLink/Create', param);\r\n  }\r\n\r\n  getShareHistory(param = {}) {\r\n    const url = `/CSP/ShipmentShareLink/GetAll`;\r\n    return this.http.get(url, param);\r\n  }\r\n\r\n  shareSend(param) {\r\n    const url = `/CSP/ShipmentShareLink/Update`;\r\n    return this.http.put(url, param);\r\n  }\r\n\r\n  shareCancel(id: number) {\r\n    const url = `/CSP/ShipmentShareLink/Cancel`;\r\n    return this.http.postJson(url, {id});\r\n  }\r\n\r\n  getShipTrack(param: { vesselName: string, startTime: string, endTime: string, needCount?: number }): Observable<VesselTrackPoint[]> {\r\n    const url = `/PUB/VesselInfos/GetShipTrack`;\r\n    if (!param.needCount) param.needCount = 100;\r\n    return this.http.get(`${url}?VesselName=CMA%20CGM%20ORFEO&StartTime=12/15/2019%201:00:00%20AM&EndTime=1/19/2020%201:00:00%20AM&needCount=10000`)\r\n    // return this.http.get(url, param)\r\n      .pipe(\r\n        map((o: any[]) => {\r\n          return o.map(point => {\r\n            return {\r\n              ...point,\r\n              point: [point.longitudeDegree, point.latitudeDegree],\r\n            } as any;\r\n          });\r\n        }),\r\n      );\r\n  }\r\n\r\n  getShipmentTrackByRes(res: ShipmentDetail) {\r\n    const route = res.routeDetails;\r\n    return this.getShipTrack({\r\n      vesselName: res.vessel,\r\n      startTime: route.estDepatureOrginPortDate,\r\n      endTime: route.estArrivalDestinationPortDate\r\n    });\r\n  }\r\n\r\n  getAllPortsForOthers(parm: { IsFromBooking?: boolean, IsFromShipment?: boolean, IsFromOrigin?: boolean, IsFromDestination?: boolean }) {\r\n    return this.http.get('/CSP/Shipment/GetAllPortsForOthers', parm);\r\n  }\r\n\r\n  getAllLocationsForOthers(parm: { IsFromBooking?: boolean, IsFromShipment?: boolean, IsFromOrigin?: boolean, IsFromDestination?: boolean }) {\r\n    return this.http.get('/CSP/Shipment/GetAllLocationsForOthers', parm);\r\n  }\r\n\r\n  getAllCompanyForOthers() {\r\n    return this.http.get('/CSP/Shipment/GetAllCompanyForOthers');\r\n  }\r\n\r\n  createOrUpdateConditionGroup(param) {\r\n    return this.http.postJson('/Platform/BusinessFilter/CreateOrUpdateConditionGroup', param);\r\n  }\r\n\r\n  getShipmentLinkDetail(Id: number) {\r\n    let params = {Id};\r\n    return this.http.get('/CSP/ShipmentShareLink/GetDetail', params);\r\n  }\r\n\r\n  /**\r\n   * shipment çè·¯çº¿\r\n   * @param details\r\n   *   ç®ååæ°æ¯æ°ç»ï¼åºè¯¥ç¨ä¸å°æ°ç»ä¼ è¿æ¥çåºè¯¥é½æ¯åä¸ª\r\n   */\r\n  getShipmentMapDataByDetails(details: ShipmentDetail[]): Observable<{icons: any[], lines: any[], dashedLines: any[]}[]> {\r\n    return forkJoin(\r\n      details.map(detail => {\r\n        return new Promise<{icons: any[], lines: any[], dashedLines: any[]}>(async resolve => {\r\n          try {\r\n            const icons = [];\r\n            const lines = [];\r\n            const dashedLines = [];\r\n            let track: any[] = [];\r\n            const portAddress =\r\n              [detail.routeDetails.originPort, detail.routeDetails.destinationPort].map(port => `${port.name},${port.fullName}`);\r\n            const portPointList = (await forkJoin(portAddress.map(o => this.amapService.googleGeo(o))).toPromise())\r\n              .map(o => [o.geometry.location.lng, o.geometry.location.lat])\r\n\r\n            if (detail.freightMethodType === FreightMethodType.Ocean) {\r\n              // port icon\r\n              icons.push({\r\n                point: portPointList[0],\r\n                icon: 'icon-port',\r\n              }, { point: portPointList[1], icon: 'icon-port' });\r\n              track = await (this.getShipmentTrackByRes(detail)\r\n                .pipe(map(o => o.map(p => p.point)))\r\n                .toPromise());\r\n              // display when on the way\r\n              if (track.length && detail.status === ShipmentStatusEnum.InTransitToArrivalPort) {\r\n                icons.push({\r\n                  point: track[track.length - 1],\r\n                  icon: 'icon-ship-round',\r\n                });\r\n              }\r\n            } else {\r\n              // port icon\r\n              icons.push({\r\n                point: portPointList[0],\r\n                icon: 'icon-port',\r\n              }, { point: portPointList[1], icon: 'icon-port' });\r\n              // display when on the way\r\n              if (detail.status === ShipmentStatusEnum.InTransitToArrivalPort) {\r\n                icons.push({\r\n                  point:\r\n                    [track[0][0] + track[1][0], track[0][1] + track[1][1]]\r\n                    /*track.reduce(\r\n                      (acc: [number, number], cur: [number, number]) => acc.map((val, i) => [val + cur[i]])\r\n                    )*/.map(o => o / 2),\r\n                  icon: 'icon-airplane',\r\n                });\r\n              }\r\n            }\r\n            // track start and end at port\r\n            track.unshift(portPointList[0]);\r\n            track.push(portPointList[1]);\r\n            // on the way or finished\r\n            if ([ShipmentStatusEnum.InTransitToArrivalPort, ShipmentStatusEnum.ArrivalPort].includes(detail.status)) {\r\n              lines.push(track);\r\n            }\r\n            dashedLines.push(track);\r\n\r\n            const address = await Promise.all([\r\n              forkJoin(\r\n                detail.routeDetails.shipperInfos.map(o => this.amapService.googleGeo(o.shipperNetWorkInfo.streetAddress))\r\n              ).toPromise(),\r\n              forkJoin(\r\n                detail.routeDetails.consigneeInfos.map(o => this.amapService.googleGeo(o.consigneeNetWorkInfo.streetAddress))\r\n              ).toPromise(),\r\n            ]);\r\n\r\n            const [shipperAddressList, consigneeAddressList] = address.map(o => o ? o : []);\r\n            [shipperAddressList, consigneeAddressList].forEach((addressList, index) => {\r\n              addressList.map(geo => {\r\n                const point = [geo.geometry.location.lng, geo.geometry.location.lat];\r\n                icons.push({\r\n                  point,\r\n                  icon: 'icon-warehouse',\r\n                });\r\n                switch (index) {\r\n                  case 0:\r\n                    dashedLines.push([point, track[0]]);\r\n                    if (detail.status > ShipmentStatusEnum.InTransitToDeparturePort) {\r\n                      lines.push([point, track[0]]);\r\n                    } else if (detail.status === ShipmentStatusEnum.InTransitToDeparturePort) {\r\n                      icons.push({\r\n                        point: [point[0] + track[0][0], point[1] + track[0][1]].map(o => o / 2),\r\n                        icon: 'icon-truck',\r\n                      });\r\n                    }\r\n                    break;\r\n                  case 1:\r\n                    dashedLines.push([track[track.length - 1], point]);\r\n                    if (detail.status > ShipmentStatusEnum.InTransitToFinalDestination) {\r\n                      lines.push([track[track.length - 1], point]);\r\n                    } else if (detail.status === ShipmentStatusEnum.InTransitToFinalDestination) {\r\n                      icons.push({\r\n                        point: [point[0] + track[track.length - 1][0], point[1] + track[track.length - 1][1]].map(o => o / 2),\r\n                        icon: 'icon-truck',\r\n                      });\r\n                    }\r\n                    break;\r\n                  default:\r\n                }\r\n              });\r\n            });\r\n\r\n            resolve({icons, lines, dashedLines});\r\n          } catch (e) {\r\n            console.error(e);\r\n            resolve(null);\r\n          }\r\n        });\r\n      })\r\n    ).pipe(\r\n      map(o => o.filter(p => p)),\r\n    );\r\n  }\r\n\r\n  /**\r\n   * shipment ç¶æç¹\r\n   * @param details\r\n   */\r\n  getIconListByDetails(details: ShipmentDetail[]): Observable<{ point: number[], template: any, icon: string, data?: any }[]> {\r\n    const iconFactory = (p, icon, detail) => ({\r\n      point: [\r\n        p.geometry.location.lng + Math.random() * 0.008 - 0.004, // prevent multiple points on one coor\r\n        p.geometry.location.lat + Math.random() * 0.008 - 0.004,\r\n      ],\r\n      template: this.componentToHtmlService.getShipmentTemplate(detail),\r\n      icon,\r\n      data: detail,\r\n    });\r\n\r\n    const portIconFactory = (port, detail: ShipmentDetail) =>\r\n      this.amapService.googleGeo(`${port.name} ${port.fullName}`)\r\n        .pipe(\r\n          map(o => iconFactory(o,  detail.freightMethodType === FreightMethodType.Ocean ? 'icon-ship-round' : 'icon-airplane', detail))\r\n        ).toPromise();\r\n\r\n    const airFreightTypeIconFactory = async (detail) => {\r\n      const portAddress =\r\n        [detail.routeDetails.originPort, detail.routeDetails.destinationPort].map(port => `${port.name},${port.fullName}`);\r\n      const track = (await forkJoin(portAddress.map(o => this.amapService.googleGeo(o))).toPromise())\r\n        .map(o => [o.geometry.location.lng, o.geometry.location.lat]);\r\n      const icons = {\r\n        point:\r\n          track.reduce(\r\n            (acc: [number, number], cur: [number, number]) => acc.map((val, i) => val + cur[i])\r\n          ).map(o => o / 2),\r\n        icon: 'icon-airplane',\r\n        template: this.componentToHtmlService.getShipmentTemplate(detail),\r\n        data: detail\r\n      };\r\n      return icons;\r\n    };\r\n\r\n    const truckIconFactory = async (repoList: any[], port, detail) => {\r\n      const geoList = await forkJoin(\r\n        repoList.map(o => this.amapService.googleGeo(o.shipperNetWorkInfo.streetAddress))\r\n      ).toPromise()\r\n      const portGeo = await this.amapService.googleGeo(`${port.name},${port.fullname}`).toPromise();\r\n      return geoList.map(geo => {\r\n        geo.geometry.location.lng = (geo.geometry.location.lng + portGeo.geometry.location.lng) / 2;\r\n        geo.geometry.location.lat = (geo.geometry.location.lat + portGeo.geometry.location.lat) / 2;\r\n        return iconFactory(geo, 'icon-truck', detail)\r\n      })\r\n    }\r\n\r\n    return forkJoin(\r\n      // map to icon array\r\n      details.map(async detail => {\r\n        try {\r\n          const originPort = detail.routeDetails.originPort;\r\n          const destinationPort = detail.routeDetails.destinationPort;\r\n\r\n          // assemble icons\r\n          switch (detail.status) {\r\n            case ShipmentStatusEnum.SellerLocation:\r\n            case ShipmentStatusEnum.OriginStopOff:\r\n            case ShipmentStatusEnum.InTransitToDeparturePort:\r\n              return forkJoin(\r\n                detail.routeDetails.shipperInfos.map(o => this.amapService.googleGeo(o.shipperNetWorkInfo.streetAddress))\r\n              ).pipe(\r\n                map(o =>\r\n                  o.map(\r\n                    p => iconFactory(p, 'icon-warehouse-round', detail)\r\n                  )\r\n                )\r\n              ).toPromise();\r\n            case ShipmentStatusEnum.DeparturePort:\r\n              return portIconFactory(detail.routeDetails.originPort, detail);\r\n            case ShipmentStatusEnum.InTransitToArrivalPort:\r\n              // ship: if has track data display last point, else in port\r\n              // air: display in way\r\n              return detail.freightMethodType === FreightMethodType.Ocean ?\r\n                this.getShipmentTrackByRes(detail)\r\n                  .pipe(\r\n                    map(o => o.length ? iconFactory({ geometry: {location: { lng: o[length-1].point[0], lat: o[length-1].point[1] }}}, 'icon-ship-round', detail) : portIconFactory(detail.routeDetails.originPort, detail))\r\n                  ).toPromise()\r\n                : airFreightTypeIconFactory(detail);\r\n            case ShipmentStatusEnum.ArrivalPort:\r\n              return portIconFactory(detail.routeDetails.destinationPort, detail)\r\n            case ShipmentStatusEnum.InTransitToFinalDestination:\r\n              return truckIconFactory(detail.routeDetails.consigneeInfos, detail.routeDetails.destinationPort, detail);\r\n            case ShipmentStatusEnum.FinalDestination:\r\n              return forkJoin(\r\n                detail.routeDetails.consigneeInfos.map(o => this.amapService.googleGeo(o.consigneeNetWorkInfo.streetAddress))\r\n              ).pipe(\r\n                map(o =>\r\n                  o.map(\r\n                    p => iconFactory(p, 'icon-warehouse-round', detail)\r\n                  )\r\n                )\r\n              ).toPromise();\r\n            default:\r\n          }\r\n        } catch (e) {\r\n          console.error(e);\r\n          return [];\r\n        }\r\n      })\r\n\r\n    ).pipe(\r\n      catchError((e) => {\r\n        console.error(e);\r\n        return of([])\r\n      }),\r\n      map(o => flatten(o)),\r\n    )\r\n  }\r\n}\r\n","import { NgModule } from '@angular/core';\nimport { ShipmentStatusPipe } from './pipes/shipment-status.pipe';\n\nconst pipes = [\n  ShipmentStatusPipe,\n]\n\n@NgModule({\n  declarations: [\n    ...pipes,\n  ],\n  imports: [\n  ],\n  exports: [\n    ...pipes,\n  ]\n})\nexport class ShipmentLibraryModule { }\n\n\nexport * from './service/shipment.service';\n"]}