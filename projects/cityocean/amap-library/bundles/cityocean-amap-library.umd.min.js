!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@angular/core"),require("@cityocean/common-library"),require("@angular/common/http"),require("rxjs"),require("rxjs/operators"),require("@angular/common")):"function"==typeof define&&define.amd?define("@cityocean/amap-library",["exports","@angular/core","@cityocean/common-library","@angular/common/http","rxjs","rxjs/operators","@angular/common"],e):e(((t=t||self).cityocean=t.cityocean||{},t.cityocean["amap-library"]={}),t.ng.core,t.commonLibrary,t.ng.common.http,t.rxjs,t.rxjs.operators,t.ng.common)}(this,(function(t,e,n,o,r,i,a){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation. All rights reserved.
    Licensed under the Apache License, Version 2.0 (the "License"); you may not use
    this file except in compliance with the License. You may obtain a copy of the
    License at http://www.apache.org/licenses/LICENSE-2.0

    THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
    WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
    MERCHANTABLITY OR NON-INFRINGEMENT.

    See the Apache Version 2.0 License for specific language governing permissions
    and limitations under the License.
    ***************************************************************************** */var s=function(){return(s=Object.assign||function(t){for(var e,n=1,o=arguments.length;n<o;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)};function c(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var o,r,i=n.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(o=i.next()).done;)a.push(o.value)}catch(t){r={error:t}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}return a}function p(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(c(arguments[e]));return t}var l=function(){function t(t){this.handler=t,this.http=new o.HttpClient(this.handler)}return t.prototype.get=function(t,e,n){return this.http.get(t,{params:e})},t.decorators=[{type:e.Injectable,args:[{providedIn:"root"}]}],t.ctorParameters=function(){return[{type:o.HttpBackend}]},t.ngInjectableDef=e.ɵɵdefineInjectable({factory:function(){return new t(e.ɵɵinject(o.HttpBackend))},token:t,providedIn:"root"}),t}();var u=function(){function t(t){this.amapHttp=t,this.googleKey="AIzaSyAEdT5BA0MmANhrmcnR4QrXu08gLtgvhqI"}return t.prototype.getMarkerByAddressListAMap=function(t,e){var n=new AMap.Geocoder({});return new r.Observable((function(e){r.forkJoin(t.map((function(t){return new r.Observable((function(e){n.getLocation(t,(function(t,n){var o;if("complete"!==t)o=[];else{var r=n.geocodes[0];o=[r.location.lng,r.location.lat]}e.next({point:o}),e.complete()}))}))}))).subscribe((function(t){e.next(t),e.complete()}))}))},t.prototype.getMarkerByLocationList=function(t){var e=this;return new r.Observable((function(n){r.forkJoin(t.map((function(t){return e.googleGeo(t.streetAddress).pipe(i.catchError((function(t){return null})))}))).subscribe((function(e){var o=e.map((function(e,n){var o=[];e&&(o=[e.geometry.location.lng,e.geometry.location.lat]);var r=t[n];return{point:o,icon:"icon-dingwei",data:r,template:{title:r.tenantName,body:""+[r.streetAddress,r.city,r.province,r.country].filter((function(t){return t})).join(", ")}}}));n.next(o),n.complete()}))}))},t.prototype.poi=function(){new AMap.PlaceSearch({city:"New York"}).search("New York",(function(t,e){}))},t.prototype.mapSearch=function(t){var e={input:t,key:"AIzaSyAEdT5BA0MmANhrmcnR4QrXu08gLtgvhqI",language:"en"};return this.amapHttp.get("http://47.254.45.110:11045/place/maps/api/place/autocomplete/json",e)},t.prototype.googleGeo=function(t){var e=this,n="http://47.254.45.110:11045/geo/maps/api/geocode/json?address="+t+"&key="+this.googleKey;return new r.Observable((function(t){e.amapHttp.get(n).subscribe((function(e){"OK"===e.status?(t.next(e.results[0]),t.complete()):t.error("Empty Geo")}),(function(e){t.error(e)}))}))},t.decorators=[{type:e.Injectable,args:[{providedIn:"root"}]}],t.ctorParameters=function(){return[{type:l}]},t.ngInjectableDef=e.ɵɵdefineInjectable({factory:function(){return new t(e.ɵɵinject(l))},token:t,providedIn:"root"}),t}();var h=function(){function t(t,n,o,r,i,a,s){this.renderer=t,this.el=n,this.zone=o,this._componentFactoryResolver=r,this.http=i,this.amapHttpService=a,this.amapService=s,this.height=800,this._markers=[],this.markerClick=new e.EventEmitter,this._icons=[],this.iconClick=new e.EventEmitter,this._lines=[],this._dashedLines=[],this._locationList=[]}return Object.defineProperty(t.prototype,"markers",{get:function(){return this._markers},set:function(t){this._markers=t,this.drawMarkers(this.markers)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"icons",{set:function(t){var e=this;t&&(this._icons=t,setTimeout((function(){e.drawIcons()})))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"lines",{set:function(t){var e=this;t&&(this._lines=t,setTimeout((function(){e.drawLine(e._lines)})))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"dashedLines",{get:function(){return this._dashedLines},set:function(t){var e=this;t&&(this._dashedLines=t,setTimeout((function(){e.drawLine(e._dashedLines,{zIndex:40,strokeStyle:"dashed"})})))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"locationList",{get:function(){return this._locationList},set:function(t){this._locationList=t,this.getAddressPointAndDraw()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"setTemplate",{set:function(t){t.body instanceof e.ElementRef&&(t.body=t.body.nativeElement.innerHTML),this._showTemplate=t},enumerable:!0,configurable:!0}),t.prototype.ngOnInit=function(){var t=this;setTimeout((function(){}),1e3);var e=m.newGuid(),n=this.mapUi.nativeElement;this.renderer.setAttribute(n,"id",e),this.renderer.setStyle(n,"height",this.height+"px"),this.width&&n.setStyle(this.el.nativeElement,"width",this.width+"px"),this.zone.runOutsideAngular((function(){t.map=new AMap.Map(e,{vectorMapForeign:"English",zoom:11,resizeEnable:!0,viewMode:"2D"})})),setTimeout((function(){t.drawMarkers(t.markers)}),1e3)},t.prototype.addMarker=function(t,e){new AMap.Marker({position:t,map:this.map,offset:new AMap.Pixel(-13,-30)});this.map.setFitView(null,!1)},t.prototype.drawMarkers=function(t){var e=this;Array.isArray(t)&&t.filter((function(t){return t.point.length})).forEach((function(t){e.addMarker(t.point,"")}))},t.prototype.drawIcons=function(t){var e=this;void 0===t&&(t=this._icons),t.forEach((function(t){return e.drawIcon(t)}))},t.prototype.drawIcon=function(t){var e=this,n=t.point,o=t.icon,r=t.template,i=t.img;AMapUI.loadUI(["overlay/SimpleMarker","overlay/SimpleInfoWindow"],(function(a,s){var c=new a({iconLabel:"",iconStyle:o?'<span class="iconfont amapicon '+o+'" ></span>':{src:i,style:{width:"30px",height:"30px"}},offset:new AMap.Pixel(-15,-15),map:e.map,showPositionPoint:!0,position:n,zIndex:100});if(c.on("click",(function(){e.iconClick.emit(t.data)})),e.map.setFitView(),r){var p=new s({infoTitle:"<strong>"+r.title+"</strong>",infoBody:r.body});AMap.event.addListener(c,"mouseover",(function(){p.open(e.map,n)})),AMap.event.addListener(c,"mouseout",(function(){p.close()}))}}))},t.prototype.drawLine=function(t,e){var n=this;void 0===e&&(e={}),t.forEach((function(t){var o=new AMap.Polyline(s({path:t,isOutline:!0,outlineColor:"#ffeeff",borderWeight:2,strokeColor:"#3366FF",strokeOpacity:1,strokeWeight:4,strokeStyle:"solid",strokeDasharray:[10,15],lineJoin:"round",lineCap:"round",zIndex:50},e));o.setMap(n.map),n.map.setFitView([o])}))},t.prototype.getDOMFromComponent=function(t,e){var n=this._componentFactoryResolver.resolveComponentFactory(t);n.data=e,this.templateCompile.clear();var o=this.templateCompile.createComponent(n);this.zone.run((function(){}));var r=o.location.nativeElement.childNodes[0].cloneNode(!0);return this.templateCompile.clear(),this.zone.run((function(){})),r},t.prototype.initRoute=function(t){var e=new t({zIndex:100,map:this.map,getPath:function(t,e){return t.path},getHoverTitle:function(t,e,n){return n>=0?t.name+"，点:"+n+"/"+t.path.length:t.name+"，点数量"+t.path.length},renderOptions:{pathLineStyle:{strokeStyle:"red",lineWidth:6,dirArrowStyle:!0}}});e.setData([{name:"轨迹0",path:[[100.340417,27.376994],[108.426354,37.827452],[113.392174,31.208439],[124.905846,42.232876]]},{name:"大地线",path:t.getGeodesicPath([116.405289,39.904987],[87.61792,43.793308],500)}]),e.createPathNavigator(.2,{loop:!0,speed:1e5}).start()},t.prototype.getAddressPointAndDraw=function(){var t=this;this.amapService.getMarkerByLocationList(this.locationList).subscribe((function(e){t.drawIcons(e)}))},t.decorators=[{type:e.Component,args:[{selector:"share-amap",template:"\r\n\r\n<div #mapUi></div>\r\n<ng-template #compile></ng-template>\r\n\x3c!-- <app-search-map></app-search-map> --\x3e\r\n",styles:["#panel{position:absolute;background-color:#ff0;max-height:90%;overflow-y:auto;top:10px;right:10px;width:280px;min-height:100px}"]}]}],t.ctorParameters=function(){return[{type:e.Renderer2},{type:e.ElementRef},{type:e.NgZone},{type:e.ComponentFactoryResolver},{type:n.HttpService},{type:l},{type:u}]},t.propDecorators={height:[{type:e.Input}],width:[{type:e.Input}],markers:[{type:e.Input}],markerClick:[{type:e.Output}],icons:[{type:e.Input}],iconClick:[{type:e.Output}],lines:[{type:e.Input}],dashedLines:[{type:e.Input}],locationList:[{type:e.Input}],ceshiMap:[{type:e.ViewChild,args:["ceshiMap",{static:!0}]}],setTemplate:[{type:e.Input}],mapUi:[{type:e.ViewChild,args:["mapUi",{static:!0}]}],templateCompile:[{type:e.ViewChild,args:["compile",{static:!0,read:e.ViewContainerRef}]}]},t}();var m=function(){function t(){}return t.newGuid=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var e=16*Math.random()|0;return("x"==t?e:3&e|8).toString(16)}))},t}();var d={0:"Seller 's Location / Booked",1:"In Transit to Departure Port",2:"In Transit to Departure Port",3:"Departure Port",4:"In Transit to Arrival Port",5:"Arrival  port",6:"In Transit to Final Destination",7:"Final destination",8:"Final destination"},f=function(){function t(){this.shipmentStatus=d,this.shipmentData={}}return t.prototype.ngOnInit=function(){},t.decorators=[{type:e.Component,args:[{selector:"lib-template-only",template:"<div #shipment>\n  <div>{{shipmentStatus[shipmentData.status]}}</div>\n  <div>Arrival: {{shipmentData.mainESTTruckDeliveryDate | date: 'yyyy-MM-dd'}}</div>\n</div>\n",styles:[""]}]}],t.ctorParameters=function(){return[]},t.propDecorators={shipmentEl:[{type:e.ViewChild,args:["shipment",{static:!0}]}]},t}();var y=[h,f],v=function(){function t(){}return t.decorators=[{type:e.NgModule,args:[{declarations:p(y),imports:[a.CommonModule],exports:p(y),entryComponents:[f]}]}],t}(),g=function(){function t(t,e,n){this.applicationRef=t,this.componentFactoryResolver=e,this.injector=n}return t.prototype.getShipmentTemplate=function(t){var e=this.componentFactoryResolver.resolveComponentFactory(f).create(this.injector);return e.instance.shipmentData=t,this.applicationRef.attachView(e.hostView),e.changeDetectorRef.detectChanges(),{title:t.shipmentNo,body:e.instance.shipmentEl.nativeElement.innerHTML}},t.decorators=[{type:e.Injectable,args:[{providedIn:"root"}]}],t.ctorParameters=function(){return[{type:e.ApplicationRef},{type:e.ComponentFactoryResolver},{type:e.Injector}]},t.ngInjectableDef=e.ɵɵdefineInjectable({factory:function(){return new t(e.ɵɵinject(e.ApplicationRef),e.ɵɵinject(e.ComponentFactoryResolver),e.ɵɵinject(e.INJECTOR))},token:t,providedIn:"root"}),t}();t.AmapHttpService=l,t.AmapLibraryModule=v,t.AmapService=u,t.ComponentToHtmlService=g,t.ɵa=h,t.ɵb=l,t.ɵc=u,t.ɵd=f,Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=cityocean-amap-library.umd.min.js.map